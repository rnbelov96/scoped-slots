# Гайд по работе со сборкой



## Модальные окна
В сборку добавлена сущность модалок.

`pug/mixins/modals/modal.pug` + `styles/blocks/modals/modal.scss` + `js/components/modals/modal.js` + `js/components/modals/init-modals.js`

Также в main.pug добавлены две модалки для примера - модальное окно обратного вызова и модальное окно статуса отправки формы.

### Процесс создания модалки

#### *pug*

##### Создание модалки

В pug/mixins/modals создать .pug файл.

```
  //- Содержимое +modal-callback
  mixin modal-callback()
    .modal__content.modal__content_center
      .modal__wrapper
        button.modal__close.js-modal-close(aria-label="Закрыть модальное окно")
        form
          h2.modal__title.js-modal-title Форма обратной связи
```

Модальное окно имеет следующую структуру:
- Контент модалки состоит из общего контейнера **modal__content** для создания затемнения и отцентровки самого окна по вертикали (с помощью модификаторов *bottom*, *central* и *top*)
- Внутри **modal__content** находится контейнер **modal__wrapper** - в нем находится содержимое модалки
- Все элементы, имеющие класс **js-modal-close**, закрывают модальное окно

##### Подключение модалки

В pug/base/mixins.pug подключить новую модалку

```
  //- Пример подключения
  include ../mixins/modals/modal-callback
```

##### Добавление модалки на страницу

```
  //- Добавить в конец страницы
  +modal('modal_callback')
    +modal-callback
```

##### Вызов модального окна

```
  //- Пример кнопки вызова модалки
  button(data-modal="callback") Вызов модального окна 
```

Для кнопки вызова модального окна обратного вызова прописаны дополнительные атрибуты:
- Используйте data-атрибут **data-form-data** для создания скрытых полей в форму модального окна. Значение атрибута JSON-объект, где ключ - имя скрытого поля, а значение ключа - значение скрытого поля
- Используйте data-атрибут **data-form-title** для добавления скрытого поля в форму модального окна со значением заголовка формы. Если внутри формы есть тэг с классом **js-modal-title**, текстовое значение этого тэга станет значение атрибута **data-form-title** 

```
  //- Пример кнопки вызова модального окна обратного вызова 
  button(data-modal="callback" data-form-data='{"name": "value"}' data-form-title="Заголовок модального окна") Вызов модального окна 
```

#### *js*

Конструктор модалки находится в **js/components/modals/modal.js**. С его помощью можно создавать модальные окна, или написать новый конструктор, наследующий от существующего.
Немного о конструкторе модалок:
- Принимает 2 параметра. Первый, обязательный, селектор контейнера модалки. Второй, необязательный, объект с 2 значениями: openCallback - функция, вызывающаяся перед открытием модалки, получает объект с 2 значениями (элемента объекта modalEl и элемента вызывающей кнопки btnEl); closeCallback - функция, вызывающаяся перед закрытием модалки.
- Можно открыть и закрыть модалку из любого места, используя общедоступные методы open и close.
- Общедоступный метод addBtn добавляет элементу прослушиватель, при клике отрывается модальное окно

##### Создание модалки

В **js/components/modals/init-modals.js** создать модалку с помощью конструктора

##### Настройка кнопок

В **js/components/modals/init-modals.js** вызвать функцию setupModalBtns, передать название модалки (значение атрибута data-modal у кнопок) и саму модалку

```
  //- Пример создания модального окна
  const callbackModal = new CallbackModal('.modal_callback');
  setupModalBtns('callback', callbackModal);
```

Опционально: экспортировать модалку для доступа к ее методам в другом месте в проекте.

#### *scss*

Стили для модалок хранятся в **styles/blocks/modals**. Общие стили для всех модалок находятся в *modal.scss*. Cтили для отдельной модалки можно прописать в отдельном файле используя модификатор.



## Настройка форм
Настройка форм прописана в **js/modules/setup-form.js**. Скрипт собирает все формы на странице и передает их функции *setupForm*

Функция *setupForm*:
- Добавляет форме скрытое поле с заголовком формы. Для этого тегу `form` нужно добавить атрибут **data-form-title**
- Добавляет служебные скрытые поля (заголовок страницы, URL страницы, относительный путь)
- Настраивает отправку данных на сервер, при этом предварительно проводится валидация данных. С помощью функции `eval` исполняется код, прописаный в атрибуте **data-onsubmit** у тега `form`. Также открывается модальное окно статуса отправки в зависимости от ответа сервера



## Валидация форм
Функция валидации находится в **js/utils/validate-form.js**, принимает один аргумент - элемент с формой. 

Функция *validateForm*:
- Ищет инпуты с атрибутам **data-input** и проверяет, чтобы от не были пустыми
- Для инпутов с номером телефона проверяется валидность номера



## Настройка инпутов
Настройка форм прописана в **js/modules/setup-form.js**. Скрипт собирает все инпуты с атрибутами **data-input** на странице и передает их функции *setupInput*.

Функция *setupInput*:
- Настраивает сброс класса `errored` при фокусе на инпут
- Для инпутов с номером телефона настраивает маску для российских номеров



## Добавление картинок
Для добавления картинок в разметку рекомендуется использовать миксин **+picture**. Он принимает 6 параметров:
- Название файла, без расширения (обязательный)
- Расширение файла без точки (обязательный)
- Список классов через пробел (необязательный)
- Значение для атрибута width (необязательный)
- Значение для атрибута height (необязательный)
- Значение для атрибута alt (необязательный)

Миксин **+picture** создает тег `picture`, внутри которого находится тег `img`, подключающий основной файл картинки, и 2 тега `source` для подключения этой же картинки в формате .avif и .webp. Картинки в этом формате появятся после сборки проекта

```
  //- Пример подключения картинки
  +picture('picture', 'jpeg', 'img --small', '1920', '1080', 'Картинка заднего фона')
```



## Создание Vue-компонента
- В **js/vue/components** создать папку для нового компонента. Все файлы, относящиеся к этому компоненту, будут находиться тут. В этой папке создать корневой .vue файл

```
  //- Пример содержимого App.vue
  <template>
    <h1>{{ title }}</h1>
  </template>

  <script>
    export default {
      data() {
        return {
          title: 'Hello World',
        };
      },
    };
  </script>
```

- В **js/vue/index.js** подключить корневой файл компонента

```
  //- Пример подключения App.vue
  import { createApp } from 'vue';
  import App from './components/app/App.vue';

  createApp(App).mount('#app');
```



## Добавление новых страниц
В папке **pug/pages** создать .pug файл, например `page.pug`. Перезапустить сборку. Теперь страница доступна по ссылке *http://localhost:8080/page.html*.



## Переменные из .env
В файле `.env` можно добавить служебные переменные, например ссылку API. После этого можно получить доступ к этой переменной из любой точки в коде через `process.env.НАЗВАНИЕ_ПЕРЕМЕННОЙ` (после изменения или добавления переменных в `.env` сборку необходимо перезапустить сборку)

```
  //- Пример переменных в .env
  API_URL_DEV=/
  API_URL_PROD=/

  //- Получение доступа к переменным
  console.log(process.env.API_URL_DEV);
  сonsole.log(process.env.API_URL_PROD);
```